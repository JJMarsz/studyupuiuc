{% extends 'base.html' %}

{% block head %}
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta name="viewport" content="width = device-width, initial-scale = 1">

<title>StudyUpUIUC</title>


<style >
/*.jumbotron{
    background-color: #2E2D88;
    color:white;
}*/
.navbar.navbar-inverse {
  margin-bottom: 5px;
}
/*.sidenav {
    height: 100%;
    width: 160px;
    position: fixed;
    z-index: 1;
    top: 30;
    right: 0;
    background-color: #111;
    overflow-x: hidden;
    padding-top: 20px;
}
.sidenav a {
    padding: 6px 8px 6px 16px;
    text-decoration: none;
    font-size: 25px;
    color: #818181;
    display: block;
}
.sidenav a:hover {
    color: #f1f1f1;
}*/
.btn-space{
    margin-right: 10px;
}
.myLink, .myLink:hover, .myLink:active, .myLink:visited, .myLink:focus {
    text-decoration:none;
}
.sidebar-offcanvas {
  width: inherit;
  min-width: 220px;
  max-width: 220px;
  background-color:#f5f5f5;
  float: right;

  z-index: 1;
  min-height: 500px;
  max-height: 500px;
  position:relative;
  overflow-y:auto;
  overflow-x:hidden;
}
#main {
  height:100%;
  overflow:auto;
}
.sessionLabel {
    margin-right: 25px;
}
</style>



{% endblock %}
{% block body %}


<!--     <div class="sidenav">
      <a href="#about">About</a>
      <a href="#services">Services</a>
      <a href="#clients">Clients</a>
      <a href="#contact">Contact</a>
    </div> -->

    <div class="row-offcanvas row-offcanvas-left">
      <div id="sidebar" class="sidebar-offcanvas">
          <div class="col-md-12">
            <h4>Study Session Maker</h4>
                <a href="{% url 'home:new_session' %}" class="btn btn-default btn-lg" role="button">Create New Session</a>
                <a href="#" class="btn btn-default btn-lg" role="button">Use Past Session</a>
          </div>
      </div>
    </div>

<div id="main">
    <div class="container">
        <form class="form-inline">
            <div class="form-group">
               <div class="dropdown">
                  <button class="btn btn-primary dropdown-toggle btn-md" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Class Filter

                    <!-- Display icon in button -->
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">

                    <!-- Unselectable header -->
                    <li class="dropdown-header">Select classes to filter</li>
                    {% for classes in enrolledin %}
                    <li><a href="#"><input type="checkbox">&nbsp;{{classes.auth_user}}</a></li>
                    {% endfor %}
                  </ul>
                </div>
            </div>

            <div class="form-group">
                <div class="input-group date" data-provide="datepicker">

                    <input class="form-control" id="date" name="date" placeholder="MM/DD/YYY" type="text"/>
                    <div class="input-group-addon">
                        <span class="glyphicon glyphicon-th"></span>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <br>

    <div class="container">
        <h3></h3>
            <div class="container">

                <!-- jinja logic here for dynamic homepage -->
                {% for classes in enrolledin %}
                <h4><a href="#{{ classes.auth_user }}Content" class = "myLink" data-toggle="collapse">{{ classes.auth_user }}</span></a></h4> <!-- eventually this will be dynamic as well with sorted classes -->
                <div id="{{ classes.auth_user }}Content" class="collapse in">
                    {% for session in sessions %}
                    {% if session.class_code == classes.auth_user %}
                    <div class="well">
                        <div>
                            <span class="sessionLabel"><label>Study Session</label></span>
                            <span class="sessionLabel"><label>{{ session.start_time }} - {{ session.end_time }}</label></span> <!-- start and end time -->
                            <span class="sessionLabel"><label>{{ session.building }} {{ session.room_number }}</label></span> <!-- location and room number -->
                            {% if session.is_owner == 1 %}

                            <form method="post">
                                {% csrf_token %} <!-- security -->
                                <button class="btn btn-danger a-btn-slide-text btn-space pull-right btn-primary btn-xs" name="delete" type="submit" value="{{session.seshID}}">
                                   <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                    <span><strong>Delete</strong></span>
                                </button>
                            </form>
                            <form method="post">
                                {% csrf_token %} <!-- security -->
                                <button class="btn btn-primary a-btn-slide-text btn-space pull-right btn-primary btn-xs" name="edit" type="submit" value="{{session.seshID}}">
                                   <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                    <span><strong>Edit</strong></span>
                                </button>
                            </form>
                            {% endif %}
                            <form id="join_session" value="{{session.seshID}}">
                                {% csrf_token %} <!-- security -->
                                <button class="btn btn-success a-btn-slide-text btn-space pull-right btn-primary btn-s" id='btnjoin{{session.seshID}}' name="join" type="submit" value="{{session.seshID}}" is_joined = "{{session.is_joined}}">
                                    <span><strong>Join</strong></span>
                                </button>
                            </form>
                        </div>
                        <br>
                        <div class="container">
                            <p>{{ session.description }}</p> <!-- decription -->
                        </div>
                    </div>
                    <!-- <input type="hidden" name="hidden_session_{{session.id}}" value={{session.id}}> -->
                    {% endif %}
                    {% endfor %}
                </div>
                {% endfor %}
                <!--
                <h4><a href="#cs411Content" data-toggle="collapse">CS 411</a></h4>
                <div id="cs411Content" class="collapse in">
                    <div class="well">
                        <div>
                            <span class="sessionLabel"><label>Office Hours</label></span>
                            <span class="sessionLabel"><label>2-3pm</label></span>
                            <span class="sessionLabel"><label>TA John Smith</label></span>
                            <span class="sessionLabel"><label>0207 Siebel Center</label></span>
                        </div>
                        <br>
                        <div class="container">
                            <p>Help with homework and prep for quizzes</p>
                        </div>
                    </div>
                    <div class="well">
                        <div>
                            <span class="sessionLabel"><label>Study Session</label></span>
                            <span class="sessionLabel"><label>6pm</label></span>
                            <span class="sessionLabel"><label>Grainger Basement</label></span>
                        </div>
                        <br>
                        <div class="container">
                            <p>Working on Homework 2. Seeking smart people.</p>
                        </div>
                    </div>
                    <div class="well">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam aliquam enim massa, id imperdiet dui pellentesque consequat. Quisque interdum risus ut justo condimentum, sed gravida felis consequat. Curabitur gravida tristique mattis. Praesent erat mauris, placerat vel blandit quis, volutpat eget nibh. Fusce semper lacinia efficitur. Pellentesque consectetur sed quam ut congue. Nulla in metus sodales, viverra orci et, volutpat sem. Nulla vulputate enim vel interdum congue. Curabitur venenatis gravida enim, quis commodo erat porttitor et. Etiam id molestie ligula. Quisque fringilla odio diam, sit amet pharetra nisi viverra sit amet. Quisque sit amet luctus massa. Aliquam varius laoreet iaculis. Vivamus fringilla risus metus, id sodales lacus finibus non.</p>
                    </div>
                </div>
                <h4><a href="#cs498Content" data-toggle="collapse">CS 498 AML</a></h4>
                <div id="cs498Content" class="collapse in">
                    <div class="well">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam aliquam enim massa, id imperdiet dui pellentesque consequat. Quisque interdum risus ut justo condimentum, sed gravida felis consequat. Curabitur gravida tristique mattis. Praesent erat mauris, placerat vel blandit quis, volutpat eget nibh. Fusce semper lacinia efficitur. Pellentesque consectetur sed quam ut congue. Nulla in metus sodales, viverra orci et, volutpat sem. Nulla vulputate enim vel interdum congue. Curabitur venenatis gravida enim, quis commodo erat porttitor et. Etiam id molestie ligula. Quisque fringilla odio diam, sit amet pharetra nisi viverra sit amet. Quisque sit amet luctus massa. Aliquam varius laoreet iaculis. Vivamus fringilla risus metus, id sodales lacus finibus non.</p>
                    </div>
                </div>
              -->
            </div>
    </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {

    {% for session in sessions %}
      var seshID =  "{{session.seshID}}";
      if($("#btnjoin" + seshID).attr('is_joined') == '1'){
        $("#btnjoin" + seshID).removeClass('btn-success');
        $("#btnjoin" + seshID).addClass('btn-danger');
        $("#btnjoin" + seshID).html('</span><span><strong>Leave</strong></span>');
      }
    {% endfor %}
  });
</script>


<script type="text/javascript">

    $(document).on('submit','#join_session',function(e){
        //e.stopPropagation();
        e.preventDefault();
        var seshID =  $(this).attr('value');
        var is_joined = ((parseInt($("#btnjoin" + seshID).attr('is_joined'))) + 1) % 2;


        $("#btnjoin" + seshID).attr('is_joined', is_joined.toString())



        // FOLLOWING FROM DJANGO WEBSITE IS FOR CSRF+AJAX
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        //END here

        $.ajax({
          type:'POST',
          url:'',
          data:{
            seshID: $(this).attr('value'),
            is_joined: $("#btnjoin" + seshID).attr('is_joined')
          },
          success:function(){
              //var seshID =  $(this).attr('value');
              if($("#btnjoin" + seshID).attr('is_joined') == "0"){
                $("#btnjoin" + seshID).removeClass('btn-danger');
                $("#btnjoin" + seshID).addClass('btn-success');
                $("#btnjoin" + seshID).html('</span><span><strong>Join</strong></span>');
              }
              else{
                $("#btnjoin" + seshID).removeClass('btn-success');
                $("#btnjoin" + seshID).addClass('btn-danger');
                $("#btnjoin" + seshID).html('</span><span><strong>Leave</strong></span>');
              }
          }

        });
    });
</script>

<!-- <div class="container">
<div class="page-header">
    <h1>Bootsrap tut</h1>
</div>
<div class="jumbotron">
    <p>asfgnsjknasdjfnalnsd fnasldfn nkjrng kjnksjnksjnktjn knkjdsfgnjn jnj jwjnrtjnjrnt nksengskdjfgnksjdnrnekrtkn</p>
    <p>
        <a href="#" class="btn btn-default btn-lg" role="button">More Info</a>
        <button type="button" value="Info" class="btn btn-info" role="button">
        <button type="submit" class="btn btn-danger" role="button">Button</button>
        <button type="submit" class="btn btn-success btn-xs" role="button">Button</button>
        <button type="submit" class="btn btn-primary btn-sm" role="button">Button</button>
        <button type="submit" class="btn btn-success btn-xs" role="button">Button</button>
        <button type="submit" class="btn btn-warning btn-lg" role="button">Button</button>
        <button type="submit" class="btn btn-link btn-lg" role="button">Button</button>
        <button type="button" class="btn btn-lg btn-primary" disabled="disabled">Primary</button>
        <a href="#" class="btn btn-default btn-lg disabled" role="button">Link</a>
        <div class="btn-group btn-group-lg" role="group">
            <button type="button" class="btn btn-default" role="button">Small</button>
            <button type="button" class="btn btn-default" role="button">Medium</button>
            <button type="button" class="btn btn-default" role="button">Large</button>
        </div>
    </p>
</div> -->





{% endblock %}
